<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <title>Dino Parks</title>
    <style> 
    table{
        border-collapse: collapse;
    }
    td{
        width: 25px;
        height: 25px;
    }
    </style>
</head>
<body>
    <h1> Dino Parks </h1>
    <div>
        <script>
        function generate_table() {
                // get the reference for the body
                var body = document.getElementsByTagName("body")[0];

                // creates a <table> element and a <tbody> element
                var tbl = document.createElement("table");
                var tblBody = document.createElement("tbody");

                // creating all cells
                for (var i = 1; i < 17; i++) {
                    // creates a table row
                    var row = document.createElement("tr");

                    for (var j = 0; j < 26; j++) {
                        var letter = String.fromCharCode(65 + j);
                        // Create a <td> element and a text node, make the text
                        // node the contents of the <td>, and put the <td> at
                        // the end of the table row
                        var cell = document.createElement("td");
                        var cellText = document.createTextNode((letter+i));
                        cell.appendChild(cellText);
                        row.appendChild(cell);
                    }

                    // add the row to the end of the table body
                    tblBody.appendChild(row);
                }

                // put the <tbody> in the <table>
                tbl.appendChild(tblBody);
                // appends <table> into <body>
                body.appendChild(tbl);
                // sets the border attribute of tbl to 2;
                tbl.setAttribute("border", "2");
            }
        generate_table();


// The following code gets the data from NUDLS

        function getData() {

            var req = new XMLHttpRequest();
            req.open("GET","https://dinoparks.net/nudls/feed" , false);
            req.send(null);
            var jsonObject = JSON.parse(req.responseText);

            return jsonObject;
        };
            var colRed = [];
            var colGreen = [];
            var gear = [];
        function safetyCheck(){
            var obj = getData();
            //console.log(obj[0].kind)
            var objLen = obj.length;
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); 
            var yyyy = today.getFullYear();

            today = mm + '-' + dd + '-' + yyyy;
            for(let i = 0; i < objLen; i ++ ){
                var date = new Date((obj[i].time.substring(0, 10)));
                timeDiff = new Date(today).getTime() - date;
                dayDiff = timeDiff / (1000 * 3600 * 24)
                //console.log("The day is difference is " + Math.floor(dayDiff));
                if((obj[i].kind === "maintenance_performed") && (dayDiff >= 30)){
                    //console.log(obj[i].location);
                    //change block to gear logo
                    gear.push(obj[i].location);

                }
                if((obj[i].kind === "maintenance_performed") && (dayDiff < 30)){
                    //console.log(obj[i].location);
                    //change block to green
                    colGreen.push(obj[i].location);

                }
                if ((obj[i].kind === "dino_location_updated")){
                    //console.log(obj[i].location);
                    //change block to red
                    colRed.push(obj[i].location);

                }
            }
            //console.log(obj[i]);
    }
        
        var mytable = document.getElementsByTagName("table")[0];
        var mytablebody = mytable.getElementsByTagName("tbody")[0];
        var colRed = ["V16", "H11","A16"]
        for (var r = 0; r < 16; r++) {

            for (var c = 0; c < 26; c++) {

                var myrow = mytablebody.getElementsByTagName("tr")[r];
                var mycel = myrow.getElementsByTagName("td")[c];
                for (var e in colRed){
                    if(mycel.innerText === e){
                        mycel.style.backgroundColor = "red";
                }
            }

        //console.log(mycel.innerText);

        //var x = document.getElementById("mytable").getElementsByTagName("td");
        // x[0].innerHTML = "i want to change my cell color";
        //x[0].style.backgroundColor = "yellow";
            }
        }
        </script>
    </div>
</body>
</html>
